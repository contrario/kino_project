# scripts/rolling_window_analysis.py

import pandas as pd
import os

# ğŸ”§ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
window_size = 200   # Î ÏŒÏƒÎµÏ‚ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ Î¸Î± Î±Î½Î±Î»ÏÏƒÎ¿Ï…Î¼Îµ
top_n = 20          # Î ÏŒÏƒÎ¿Î¹ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î¿Î¯ Î±ÏÎ¹Î¸Î¼Î¿Î¯ Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ±Ï†Î¿ÏÎ½

# ğŸ“‚ Î”Î¹Î±Î´ÏÎ¿Î¼Î® Î³Î¹Î± Ï€ÏÎ¿ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
input_file = os.path.join('..', 'data', 'kino_data_prepared.csv')

# ğŸ” Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv(input_file)

# âœ… Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¿Ï…Î¼Îµ Ï„Î¹Ï‚ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ N ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚
df_recent = df.tail(window_size)

# ğŸ“Š ÎœÎ±Î¶ÎµÏÎ¿Ï…Î¼Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚ ÏƒÎµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î±
all_numbers = df_recent[
    [f'number_{i}' for i in range(1, 21)]
].values.ravel()

# ğŸ“ˆ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ…Ï‡Î½Î¿Ï„Î®Ï„Ï‰Î½
freq_series = pd.Series(all_numbers).value_counts().sort_values(ascending=False)

# ğŸ¯ Î•Ï€Î¹Î»Î¿Î³Î® Ï„Ï‰Î½ Top-N Î±ÏÎ¹Î¸Î¼ÏÎ½
top_numbers = freq_series.head(top_n).index.tolist()

# ğŸ“¤ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)
output_file = os.path.join('..', 'outputs', f'top_{top_n}_numbers.csv')
pd.DataFrame({'number': top_numbers}).to_csv(output_file, index=False)

# ğŸ“ƒ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î·
print(f"ğŸ“Š Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ {window_size} ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ â€” Î£Ï…Ï‡Î½ÏŒÏ„ÎµÏÎ¿Î¹ {top_n} Î±ÏÎ¹Î¸Î¼Î¿Î¯:")
print(top_numbers)
