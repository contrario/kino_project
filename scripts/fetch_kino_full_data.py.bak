import requests
import pandas as pd
from datetime import datetime, timedelta
import os

# ğŸ”§ Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Ï€ÎµÏÎ¹ÏŒÎ´Î¿Ï… (Ï€.Ï‡. Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ 3 Î·Î¼Î­ÏÎµÏ‚)
days_back = 3
to_date = datetime.today().date()
from_date = to_date - timedelta(days=days_back)

# ğŸ”— URL API
url = f"https://api.opap.gr/draws/v3.0/1100/draw-date/{from_date}/{to_date}"

print(f"ğŸ“¡ Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ {from_date} Î­Ï‰Ï‚ {to_date}...")

# ğŸ” Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ·
response = requests.get(url)
data = response.json()

# ğŸ“¦ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
records = []
for draw in data.get("content", []):
    record = {
        "drawId": draw.get("drawId"),
        "drawTime": draw.get("drawTime"),
        "numbers": ";".join(map(str, draw.get("winningNumbers", {}).get("list", [])))
    }
    records.append(record)

df = pd.DataFrame(records)

# ğŸ“‚ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
output_dir = "../data"
os.makedirs(output_dir, exist_ok=True)
output_file = os.path.join(output_dir, "kino_full_data.csv")
df.to_csv(output_file, index=False)

print(f"âœ… Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½ {len(df)} ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: {output_file}")
