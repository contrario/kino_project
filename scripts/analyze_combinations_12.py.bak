# analyze_combinations_12.py

import pandas as pd
from itertools import combinations
from collections import Counter
import os

# ğŸ” Î’Î®Î¼Î± 1: ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿
dataset_path = os.path.join("data", "kino_draws.csv")
if not os.path.exists(dataset_path):
    print(f"âŒ Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ: {dataset_path}")
    exit()

# ğŸ“¥ Î’Î®Î¼Î± 2: Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv(dataset_path)

# âœ… ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚
expected_columns = [f'num_{i}' for i in range(1, 21)]
if not all(col in df.columns for col in expected_columns):
    print(f"âŒ ÎŸÎ¹ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÏƒÏ„Î®Î»ÎµÏ‚ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½.")
    print(f"ğŸ“Œ ÎŸÎ¹ ÏƒÏ„Î®Î»ÎµÏ‚ Ï€Î¿Ï… Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ¯Î½Î±Î¹: {list(df.columns)}")
    exit()

# ğŸ”„ Î’Î®Î¼Î± 3: Î£Ï…Î»Î»Î¿Î³Î® Î±ÏÎ¹Î¸Î¼ÏÎ½ Î±Î½Î¬ ÎºÎ»Î®ÏÏ‰ÏƒÎ·
draw_numbers = df[expected_columns].values.tolist()

# ğŸ§® Î’Î®Î¼Î± 4: Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ 12Î¬Î´Ï‰Î½ ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·
counter = Counter()
for draw in draw_numbers:
    draw_combinations = combinations(sorted(draw), 12)
    counter.update(draw_combinations)

# ğŸ“Š Î’Î®Î¼Î± 5: Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ±Ï„Î¬ ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
most_common_combinations = counter.most_common(10)
results_df = pd.DataFrame(most_common_combinations, columns=['Combination', 'Frequency'])

# ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÎµ CSV
output_path = os.path.join("output", "top_12_combinations.csv")
os.makedirs("output", exist_ok=True)
results_df.to_csv(output_path, index=False)

# âœ… ÎœÎ®Î½Ï…Î¼Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚
print("âœ… ÎŸÎ¹ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î­Ï‚ 12Î¬Î´ÎµÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Î·ÎºÎ±Î½ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!")
print(results_df)
