import pandas as pd
import os
from collections import Counter
from ast import literal_eval
from time import time

start = time()
print("ğŸ”¥ Î‘Î½Î¬Î»Ï…ÏƒÎ· Hot & Cold Î±ÏÎ¹Î¸Î¼ÏÎ½ ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·...")

# --------------------------------------------------
# 1. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
# --------------------------------------------------
csv_path = "data/kino_data.csv"
df = pd.read_csv(csv_path)

# --------------------------------------------------
# 2. Î•ÏÏÎµÏƒÎ· ÏƒÏ‰ÏƒÏ„Î®Ï‚ ÏƒÏ„Î®Î»Î·Ï‚ Î¼Îµ Ï„Î¿Ï…Ï‚ Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚
# --------------------------------------------------
possible_cols = ["winning_numbers", "winningNumbers", "numbers"]
num_col = None
for col in possible_cols:
    if col in df.columns:
        num_col = col
        break

if num_col is None:
    print("âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î®Î»Î· Î¼Îµ Î»Î¯ÏƒÏ„Î± Î±ÏÎ¹Î¸Î¼ÏÎ½ KINO.")
    print(f"ğŸ“‹ Î£Ï„Î®Î»ÎµÏ‚ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: {list(df.columns)}")
    exit(1)

print(f"âœ… Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î· ÏƒÏ„Î®Î»Î·: '{num_col}'")

# --------------------------------------------------
# 3. ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® string â†’ Î»Î¯ÏƒÏ„Î± int
# --------------------------------------------------
df[num_col] = df[num_col].apply(literal_eval)

# --------------------------------------------------
# 4. Î£Ï…Î»Î»Î¿Î³Î® & ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î±
# --------------------------------------------------
all_nums = [n for sub in df[num_col] for n in sub]
counts = Counter(all_nums)
freq_df = pd.DataFrame(sorted(counts.items()), columns=["Number", "Frequency"])

# --------------------------------------------------
# 5. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
# --------------------------------------------------
os.makedirs("results", exist_ok=True)
freq_df.to_csv("results/number_frequency.csv", index=False)

top10 = freq_df.sort_values("Frequency", ascending=False).head(10)
bot10 = freq_df.sort_values("Frequency", ascending=True).head(10)

top10.to_csv("results/hot_numbers.csv", index=False)
bot10.to_csv("results/cold_numbers.csv", index=False)

print("âœ… ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ Î· Î±Î½Î¬Î»Ï…ÏƒÎ· Hot & Cold Î±ÏÎ¹Î¸Î¼ÏÎ½!")
print("ğŸ”¥ Top-10 â†’ results/hot_numbers.csv")
print("â„ï¸ Cold-10 â†’ results/cold_numbers.csv")
print("ğŸ“Š Î£ÏÎ½Î¿Î»Î¿  â†’ results/number_frequency.csv")
print(f"â±ï¸ Î§ÏÏŒÎ½Î¿Ï‚ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚: {round(time() - start, 2)} sec")

