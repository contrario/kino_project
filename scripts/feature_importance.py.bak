import os
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.ensemble import RandomForestClassifier

# ğŸ”§ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†Î±ÎºÎ­Î»Î¿Ï… outputs Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
os.makedirs('outputs', exist_ok=True)

# ğŸ”¹ 1. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv('data/kino_features_enriched.csv')

# ğŸ”¹ 2. Drop ÏƒÏ„Î®Î»ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ features
X = df.drop(columns=['draw_id', 'draw_time', 'is_7_hit'])
y = df['is_7_hit']

# ğŸ”¹ 3. Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· Î¼Î¿Î½Ï„Î­Î»Î¿Ï…
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X, y)

# ğŸ”¹ 4. Î›Î®ÏˆÎ· ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½
importances = model.feature_importances_
features = X.columns
importance_df = pd.DataFrame({'feature': features, 'importance': importances})
importance_df = importance_df.sort_values(by='importance', ascending=False)

# ğŸ”¹ 5. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
importance_df.to_csv('outputs/feature_importance.csv', index=False)
print("âœ… Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ Ï„Î¿ feature_importance.csv")

# ğŸ”¹ 6. Î“ÏÎ¬Ï†Î·Î¼Î±
plt.figure(figsize=(12, 6))
sns.barplot(x='importance', y='feature', data=importance_df.head(20))
plt.title('Top 20 Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„ÎµÏÎ± Î§Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬')
plt.tight_layout()
plt.savefig('outputs/feature_importance_plot.png')
print("ğŸ“Š Î¤Î¿ Î³ÏÎ¬Ï†Î·Î¼Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÏƒÏ„Î¿ outputs/feature_importance_plot.png")

