import json
from datetime import datetime
import os

# --- Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î”ÎµÎ»Ï„Î¯Î¿Ï… ---
ticket_draws = 10         # Î ÏŒÏƒÎµÏ‚ ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ Î¸Î± Ï€Î±Î¯Î¾ÎµÎ¹
ticket_cost_per_draw = 0.50
ticket_numbers_count = 20

# --- Paths ---
data_path = "../data/rolling_window_top_numbers.json"
output_dir = "../outputs"
os.makedirs(output_dir, exist_ok=True)

# --- Î¦ÏŒÏÏ„Ï‰ÏƒÎµ Top Î‘ÏÎ¹Î¸Î¼Î¿ÏÏ‚ Î±Ï€ÏŒ JSON ---
with open(data_path, "r") as f:
    top_numbers = json.load(f)

if not isinstance(top_numbers, list) or len(top_numbers) < ticket_numbers_count:
    raise ValueError("âŒ ÎœÎ· Î­Î³ÎºÏ…ÏÎ± Î´ÎµÎ´Î¿Î¼Î­Î½Î± top Î±ÏÎ¹Î¸Î¼ÏÎ½ Î³Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ»Ï„Î¯Î¿Ï….")

# --- Î•Ï€Î¹Î»Î¿Î³Î® Î‘ÏÎ¹Î¸Î¼ÏÎ½ ---
selected_numbers = top_numbers[:ticket_numbers_count]

# --- Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î”ÎµÎ»Ï„Î¯Î¿Ï… ---
total_cost = ticket_draws * ticket_cost_per_draw
now = datetime.now()
ticket_info = {
    "Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±": now.strftime("%Y-%m-%d %H:%M"),
    "Î±ÏÎ¹Î¸Î¼Î¿Î¯": selected_numbers,
    "ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚": ticket_draws,
    "ÎºÏŒÏƒÏ„Î¿Ï‚ (â‚¬)": f"{total_cost:.2f}"
}

# --- Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· ---
print("\nğŸ¯ Î”ÎµÎ»Ï„Î¯Î¿ Î³Î¹Î± 10 ÎšÎ»Î·ÏÏÏƒÎµÎ¹Ï‚:")
print("Î‘ÏÎ¹Î¸Î¼Î¿Î¯:", selected_numbers)
print(f"ğŸ“… Î™ÏƒÏ‡ÏÎµÎ¹ Î³Î¹Î± Ï„Î¹Ï‚ ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ {ticket_draws} ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚")
print(f"ğŸ’° ÎšÏŒÏƒÏ„Î¿Ï‚: {total_cost:.2f} â‚¬")

# --- Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÎµ Î±ÏÏ‡ÎµÎ¯Î¿ ---
filename = f"ticket_{now.strftime('%Y-%m-%d_%H-%M')}.txt"
filepath = os.path.join(output_dir, filename)

with open(filepath, "w", encoding="utf-8") as f:
    f.write("ğŸ¯ Î”ÎµÎ»Ï„Î¯Î¿ ÎšÎ™ÎÎŸ (Top 20)\n")
    f.write(f"Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: {ticket_info['Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±']}\n")
    f.write(f"Î‘ÏÎ¹Î¸Î¼Î¿Î¯: {', '.join(map(str, selected_numbers))}\n")
    f.write(f"ÎšÎ»Î·ÏÏÏƒÎµÎ¹Ï‚: {ticket_info['ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚']}\n")
    f.write(f"ÎšÏŒÏƒÏ„Î¿Ï‚: {ticket_info['ÎºÏŒÏƒÏ„Î¿Ï‚ (â‚¬)']} â‚¬\n")

print(f"\nâœ… Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: {filepath}")
