import os
import pandas as pd
from itertools import combinations
from collections import Counter

# Î’ÏÎ¯ÏƒÎºÎ¿Ï…Î¼Îµ Ï„Î· ÏƒÏ‰ÏƒÏ„Î® Î´Î¹Î±Î´ÏÎ¿Î¼Î®
csv_path = os.path.join(os.path.dirname(__file__), '..', 'data', 'kino_data.csv')

# ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿
if not os.path.exists(csv_path):
    print(f"âŒ Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ: {csv_path}")
    exit()

# Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï…
df = pd.read_csv(csv_path)

# Î•Î¾Î±Î³Ï‰Î³Î® Ï„Ï‰Î½ 20 Î±ÏÎ¹Î¸Î¼ÏÎ½ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚ num_1 Î­Ï‰Ï‚ num_20
number_columns = [f'num_{i}' for i in range(1, 21)]

if not all(col in df.columns for col in number_columns):
    print("âŒ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏŒÎ»ÎµÏ‚ Î¿Î¹ ÏƒÏ„Î®Î»ÎµÏ‚ num_1 Î­Ï‰Ï‚ num_20.")
    print(f"ğŸ“Œ Î’ÏÎ­Î¸Î·ÎºÎ±Î½ Î¿Î¹ ÏƒÏ„Î®Î»ÎµÏ‚: {list(df.columns)}")
    exit()

draws = df[number_columns].values.tolist()

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ 5Î¬Î´Ï‰Î½
all_combinations = []
for draw in draws:
    all_combinations.extend(combinations(sorted(draw), 5))

# ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ…Ï‡Î½ÏŒÏ„ÎµÏÏ‰Î½ 5Î¬Î´Ï‰Î½
counter = Counter(all_combinations)
most_common_combos = pd.DataFrame(counter.most_common(10), columns=['Combination', 'Frequency'])

# Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
output_folder = os.path.join(os.path.dirname(__file__), '..', 'results')
os.makedirs(output_folder, exist_ok=True)
output_path = os.path.join(output_folder, 'most_common_combinations_5.csv')
most_common_combos.to_csv(output_path, index=False)

# Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
print("âœ… ÎŸÎ¹ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î­Ï‚ 5Î¬Î´ÎµÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Î·ÎºÎ±Î½ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!")
print(most_common_combos)

