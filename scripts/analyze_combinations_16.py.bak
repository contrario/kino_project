import pandas as pd
from itertools import combinations
from collections import Counter
import time
import os

start_time = time.time()
print("ğŸ” Î‘Î½Î¬Î»Ï…ÏƒÎ· 16Î¬Î´Ï‰Î½ Î¼Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 14 ÎµÏ€Î¹Ï„Ï…Ï‡Î¯ÎµÏ‚...")

# ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv("data/kino_data.csv")

# ğŸ¯ Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î®Î»Î·Ï‚
if 'winningNumbers' not in df.columns:
    raise ValueError("âŒ Î— ÏƒÏ„Î®Î»Î· 'winningNumbers' Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿.")

# ğŸ” Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± Î³Î¹Î± ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ Î¼Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 14 Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚ (Ï€ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÏŒ)
df_filtered = df[df['winningNumbers'].apply(lambda x: len(eval(x)) >= 14)]

# ğŸ“Š Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ 16Î¬Î´Ï‰Î½
all_combinations = []
for draw in df_filtered['winningNumbers']:
    numbers = eval(draw)
    combos = combinations(sorted(numbers), 16)
    all_combinations.extend(combos)

# ğŸ§® Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„ÎµÏ‚
counter = Counter(all_combinations)
most_common = counter.most_common(10)

# ğŸ“ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†Î±ÎºÎ­Î»Î¿Ï… Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½ Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
os.makedirs("results", exist_ok=True)

# ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½
df_results = pd.DataFrame(most_common, columns=["Combination", "Frequency"])
df_results.to_csv("results/most_common_combinations_16.csv", index=False)

print("âœ… ÎŸÎ¹ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î­Ï‚ 16Î¬Î´ÎµÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Î·ÎºÎ±Î½ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!")
print(f"â±ï¸ Î§ÏÏŒÎ½Î¿Ï‚ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚: {round(time.time() - start_time, 2)} Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±")



