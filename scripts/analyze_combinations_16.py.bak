import pandas as pd
from itertools import combinations
from collections import Counter
import time
import os

start_time = time.time()
print("🔍 Ανάλυση 16άδων με τουλάχιστον 14 επιτυχίες...")

# 📥 Φόρτωση δεδομένων
df = pd.read_csv("data/kino_data.csv")

# 🎯 Διόρθωση ονόματος στήλης
if 'winningNumbers' not in df.columns:
    raise ValueError("❌ Η στήλη 'winningNumbers' δεν βρέθηκε στο αρχείο.")

# 🔎 Φιλτράρισμα για κληρώσεις με τουλάχιστον 14 αριθμούς (προληπτικό)
df_filtered = df[df['winningNumbers'].apply(lambda x: len(eval(x)) >= 14)]

# 📊 Υπολογισμός όλων των 16άδων
all_combinations = []
for draw in df_filtered['winningNumbers']:
    numbers = eval(draw)
    combos = combinations(sorted(numbers), 16)
    all_combinations.extend(combos)

# 🧮 Συχνότητες
counter = Counter(all_combinations)
most_common = counter.most_common(10)

# 📁 Δημιουργία φακέλου αποτελεσμάτων αν δεν υπάρχει
os.makedirs("results", exist_ok=True)

# 💾 Αποθήκευση αποτελεσμάτων
df_results = pd.DataFrame(most_common, columns=["Combination", "Frequency"])
df_results.to_csv("results/most_common_combinations_16.csv", index=False)

print("✅ Οι πιο συχνές 16άδες υπολογίστηκαν και αποθηκεύτηκαν!")
print(f"⏱️ Χρόνος εκτέλεσης: {round(time.time() - start_time, 2)} δευτερόλεπτα")



