import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import os

# ğŸ“‚ ÎœÎ¿Î½Î¿Ï€Î¬Ï„Î¹ Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… ÎºÎ±Î¹ ÎµÎ¾ÏŒÎ´Î¿Ï…
input_file = '../data/kino_data_prepared.csv'
output_img = '../outputs/heatmap_hourly.png'

print("â³ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Heatmap Î±Î½Î¬ ÎÏÎ±...")

# ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv(input_file)

# âœ… ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Ï‰Î½ ÏƒÏ„Î·Î»ÏÎ½
expected_cols = ['hour'] + [f'number_{i}' for i in range(1, 21)]
missing_cols = [col for col in expected_cols if col not in df.columns]
if missing_cols:
    raise ValueError(f"âŒ Î›ÎµÎ¯Ï€Î¿Ï…Î½ Î¿Î¹ ÎµÎ¾Î®Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: {missing_cols}")

# ğŸ”„ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ dataframe Î¼Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎµÎ¹Ï‚ Î±ÏÎ¹Î¸Î¼ÏÎ½ Î±Î½Î¬ ÏÏÎ±
all_numbers = []
for i in range(1, 21):
    temp_df = df[['hour', f'number_{i}']].rename(columns={f'number_{i}': 'number'})
    all_numbers.append(temp_df)

combined_df = pd.concat(all_numbers)

# ğŸ”¢ ÎŸÎ¼Î±Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Î¹ Î¼Î­Ï„ÏÎ·ÏƒÎ· ÏƒÏ…Ï‡Î½Î¿Ï„Î®Ï„Ï‰Î½
heatmap_data = combined_df.groupby(['hour', 'number']).size().unstack(fill_value=0)

# ğŸ–¼ï¸ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
plt.figure(figsize=(16, 9))
sns.heatmap(heatmap_data, cmap='YlOrRd', annot=False, cbar=True, linewidths=.5)

plt.title("ğŸ”¥ Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î‘ÏÎ¹Î¸Î¼ÏÎ½ KINO Î‘Î½Î¬ ÎÏÎ±", fontsize=16)
plt.xlabel("Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚")
plt.ylabel("ÎÏÎ±")
plt.xticks(rotation=0)
plt.yticks(rotation=0)
plt.tight_layout()

# ğŸ“ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Ï†Î±ÎºÎ­Î»Î¿Ï… ÎµÎ¾ÏŒÎ´Î¿Ï…
os.makedirs(os.path.dirname(output_img), exist_ok=True)

# ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎµÎ¹ÎºÏŒÎ½Î±Ï‚
plt.savefig(output_img)
print(f"âœ… Heatmap Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ: {output_img}")






