import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import os

# 📂 Μονοπάτι αρχείου εισόδου και εξόδου
input_file = '../data/kino_data_prepared.csv'
output_img = '../outputs/heatmap_hourly.png'

print("⏳ Δημιουργία Heatmap ανά Ώρα...")

# 📥 Φόρτωση δεδομένων
df = pd.read_csv(input_file)

# ✅ Έλεγχος απαραίτητων στηλών
expected_cols = ['hour'] + [f'number_{i}' for i in range(1, 21)]
missing_cols = [col for col in expected_cols if col not in df.columns]
if missing_cols:
    raise ValueError(f"❌ Λείπουν οι εξής στήλες από το αρχείο: {missing_cols}")

# 🔄 Δημιουργία ενός dataframe με όλες τις εμφανίσεις αριθμών ανά ώρα
all_numbers = []
for i in range(1, 21):
    temp_df = df[['hour', f'number_{i}']].rename(columns={f'number_{i}': 'number'})
    all_numbers.append(temp_df)

combined_df = pd.concat(all_numbers)

# 🔢 Ομαδοποίηση και μέτρηση συχνοτήτων
heatmap_data = combined_df.groupby(['hour', 'number']).size().unstack(fill_value=0)

# 🖼️ Δημιουργία γραφήματος
plt.figure(figsize=(16, 9))
sns.heatmap(heatmap_data, cmap='YlOrRd', annot=False, cbar=True, linewidths=.5)

plt.title("🔥 Συχνότητα Αριθμών KINO Ανά Ώρα", fontsize=16)
plt.xlabel("Αριθμός")
plt.ylabel("Ώρα")
plt.xticks(rotation=0)
plt.yticks(rotation=0)
plt.tight_layout()

# 📁 Έλεγχος φακέλου εξόδου
os.makedirs(os.path.dirname(output_img), exist_ok=True)

# 💾 Αποθήκευση εικόνας
plt.savefig(output_img)
print(f"✅ Heatmap αποθηκεύτηκε: {output_img}")






