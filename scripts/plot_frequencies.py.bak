import pandas as pd
import matplotlib.pyplot as plt
import os

# ğŸ“ Î’ÏÎµÏ‚ Ï„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ Ï„Î¿Ï… script
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
input_file = os.path.join(BASE_DIR, "..", "data", "number_frequencies.csv")

if not os.path.exists(input_file):
    print(f"âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: {input_file}")
    exit()

# ğŸ“¥ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
df = pd.read_csv(input_file)
df = df.sort_values(by="Number").reset_index(drop=True)

# ğŸ” Top 10 Î±ÏÎ¹Î¸Î¼Î¿Î¯ Î¼Îµ Ï„Î¹Ï‚ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎµÏ‚ ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„ÎµÏ‚
top10 = df.sort_values(by="Frequency", ascending=False).head(10)["Number"].tolist()

# ğŸ¨ ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï‡ÏÏ‰Î¼Î¬Ï„Ï‰Î½: ÎºÏŒÎºÎºÎ¹Î½Î¿ Î³Î¹Î± top10, Î¼Ï€Î»Îµ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿Ï…Ï‚
colors = ['red' if n in top10 else 'steelblue' for n in df['Number']]

# ğŸ“Š Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
plt.figure(figsize=(14, 6))
bars = plt.bar(df['Number'], df['Frequency'], color=colors)

# ğŸ’¬ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¹Î¼ÏÎ½ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¼Ï€Î¬ÏÎµÏ‚
for bar in bars:
    height = bar.get_height()
    if height > 0:
        plt.annotate(f'{int(height)}',
                     xy=(bar.get_x() + bar.get_width() / 2, height),
                     xytext=(0, 3),
                     textcoords="offset points",
                     ha='center', va='bottom', fontsize=8)

# ğŸ–¼ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î¬Î¾Î¿Î½ÎµÏ‚
plt.xlabel("Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚")
plt.ylabel("Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚")
plt.title("Î£Ï…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î‘ÏÎ¹Î¸Î¼ÏÎ½ KINO (Top 10 = ÎšÏŒÎºÎºÎ¹Î½Î¿)")
plt.xticks(rotation=90)
plt.grid(axis='y', linestyle='--', alpha=0.5)

# ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
output_path = os.path.join(BASE_DIR, "..", "data", "frequency_plot.png")
plt.tight_layout()
plt.savefig(output_path, dpi=150)
plt.show()

print(f"âœ… Î¤Î¿ Î³ÏÎ¬Ï†Î·Î¼Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÏƒÏ„Î¿: {output_path}")


